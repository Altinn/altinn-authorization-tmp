@page "/area/{id}"
@using Altinn.Authorization.AccessPackages.Models
@inject LocalRepo repo

<Article>

    @if (Area != null)
    {
        <BreadcrumbContainer>
            <BreadcrumbItem Url=@($"/areagroup/{Group.Id}")>@Group.Name</BreadcrumbItem>
            <BreadcrumbItem Url=@($"/area/{Area.Id}")>@Area.Name</BreadcrumbItem>
        </BreadcrumbContainer>


        <H1>@Area.Name</H1>
        <p>@Area.Description</p>

        <div>
            <table class="bf-table bfc-base-3-bg">
                <thead>
                    <tr class="bf-table-row bf-table-row-compact">
                        <th>Pakker</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var package in Packages)
                    {
                        <tr class="bf-table-row bf-table-row-compact">
                            <td><a href="/area/@id/#@package.Name.Replace("-","").Replace(" ","-").ToLower()">@package.Name</a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <br />

        <H2>Pakker</H2>
        @foreach (var package in Packages)
        {
            <a class="anchor" id="@package.Name.Replace("-","").Replace(" ","-").ToLower()"></a>
            <div>
                <H3>@package.Name</H3>
                <p>
                    @package.Description
                    <br />
                    <em>urn:altinnn:accesspackage:@package.Name.Replace("-","").Replace(" ","-").ToLower()</em>
                </p>
            </div>
        }

        <div>
            <H2>Rollekoblinger</H2>
            <p>Hvilke roller fra Enhetsregisteret får fullmakt til tilgangspakken</p>
            <table class="bf-table bfc-base-3-bg">
                <thead>
                    <tr class="bf-table-row bf-table-row-compact">
                        <th>Pakke</th>
                        <th>Rolle</th>
                        <th>Delegerbar</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var package in Packages)
                    {
                        <tr class="bf-table-row bf-table-row-compact">
                            <td><a href=@($"/package/{package.Id}")>@package.Name</a></td>
                            <td>
                                <Badge>DAGL</Badge>
                            </td>
                            <td><Icon Name="check"></Icon></td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>


    }
</Article>

@code {

    [Parameter] public string id { get; set; }
    public AreaGroup Group { get; set; }
    public Area Area { get; set; }
    public IEnumerable<Package> Packages { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        Area = repo.GetArea(Guid.Parse(id)) ?? new Area();
        Group = repo.GetGroups().FirstOrDefault(t => t.Id == Area.GroupId) ?? new AreaGroup();
        Packages = repo.GetPackages(Area.Id);
    }
}

